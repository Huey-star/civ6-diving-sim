<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ˜6ï¼šç»æœ›è·³æ°´æ¨¡æ‹Ÿå™¨ V5.0 (å·´æ¯”ä¼¦é£å¤©ç‰ˆ)</title>
    <style>
        :root {
            --civ-gold: #c6a664;
            --civ-blue: #1c2e4a;
            --civ-dark: #0f1a2b;
            --text-light: #e0e0e0;
            --win-green: #2ecc71;
            --lose-red: #e74c3c;
            --special-purple: #9b59b6;
        }

        body {
            background-color: var(--civ-dark);
            color: var(--text-light);
            font-family: 'Georgia', 'Times New Roman', serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            text-align: center;
        }

        #game-container {
            background: linear-gradient(145deg, #16243b, #0d1624);
            border: 2px solid var(--civ-gold);
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            position: relative;
        }

        h1 {
            color: var(--civ-gold);
            margin-bottom: 5px;
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: text-shadow 0.3s;
        }
        
        h1:hover {
            text-shadow: 0 0 10px var(--civ-gold);
        }

        .subtitle {
            font-size: 12px;
            color: #889bb5;
            margin-bottom: 20px;
            font-style: italic;
        }

        .screen { display: none; }
        .active-screen { display: block; }

        #loading-screen {
            height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .quote {
            font-size: 18px;
            line-height: 1.6;
            margin: 15px 0;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .loader-bar {
            width: 80%;
            height: 4px;
            background: #333;
            margin-top: 20px;
            border-radius: 2px;
            overflow: hidden;
        }

        .loader-progress {
            width: 0%;
            height: 100%;
            background: var(--civ-gold);
            transition: width 0.1s linear;
        }

        .card {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 3px solid var(--civ-gold);
            text-align: left;
        }

        .label { color: #889bb5; font-size: 12px; text-transform: uppercase; }
        .value { font-size: 16px; font-weight: bold; margin-top: 5px; }

        .comment {
            font-style: italic;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.5);
            text-align: center;
            min-height: 20px;
        }

        #outcome-title { font-size: 28px; font-weight: bold; margin-bottom: 20px; }
        #outcome-desc { font-size: 16px; line-height: 1.6; margin-bottom: 30px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 8px; text-align: left;}

        .btn-group { margin-top: 20px; display: flex; gap: 10px; }
        button { border: none; padding: 12px 20px; font-family: inherit; font-weight: bold; cursor: pointer; transition: all 0.2s; text-transform: uppercase; border-radius: 4px; flex: 1; }
        .btn-restart { background-color: var(--civ-gold); color: var(--civ-dark); font-size: 16px; }
        .btn-restart:hover { background-color: #d4b470; transform: scale(1.02); }
        .btn-play { background-color: transparent; border: 1px solid #889bb5; color: #889bb5; }
        .btn-play:hover { background-color: rgba(136, 155, 181, 0.1); color: white; }

        #stats { margin-top: 20px; font-size: 12px; color: #666; border-top: 1px solid #333; padding-top: 10px; }
    </style>
</head>
<body>

<div id="game-container">
    <h1 onclick="triggerGodMode()" style="cursor: pointer; user-select: none;" title="ä½œå¼Šé€šé“ï¼šç‚¹å‡»éšæœºè¿›å…¥ä¸€ä¸ªç‰¹æ®Šå‰§æœ¬">
        Civ VI: Diving Simulator
    </h1>
    <div class="subtitle">"ä¸‹ä¸€å›åˆ... ç§‘æŠ€æ ‘å·²è¢«æ‰“ä¹±..."</div>

    <div id="loading-screen" class="screen" style="display:none;">
        <div id="quote-text" class="quote"></div>
        <div class="loader-bar">
            <div id="loader-progress" class="loader-progress"></div>
        </div>
        <div style="margin-top:10px; font-size:12px; color:#666;">æ­£åœ¨è®¡ç®—è›®æ—ç§»åŠ¨è·¯å¾„...</div>
    </div>

    <div id="result-screen" class="screen">
        <div class="card">
            <div class="label">é¢†è¢– & æ–‡æ˜</div>
            <div class="value" id="civ-name">???</div>
        </div>
        
        <div class="card">
            <div class="label">å‡ºç”Ÿåœ°æ¦‚å†µ</div>
            <div class="value" id="terrain-info">???</div>
        </div>

        <div class="card">
            <div class="label">å‘¨è¾¹èµ„æº</div>
            <div class="value" id="resource-info">???</div>
        </div>

        <div class="comment" id="system-comment">
            è¯„ä»·åŠ è½½ä¸­...
        </div>

        <div class="btn-group">
            <button class="btn-restart" onclick="startDive()">ğŸ”„ åƒåœ¾å›¾ï¼Œé‡å¼€ (è·³æ°´)</button>
            <button class="btn-play" onclick="playGame()">âœ… å°±ç©è¿™æŠŠäº†</button>
        </div>
    </div>

    <div id="outcome-screen" class="screen">
        <div id="outcome-title">æ¸¸æˆç»“æŸ</div>
        <div id="outcome-desc">æè¿°æ–‡æœ¬</div>
        <button class="btn-restart" onclick="startDive()">ğŸ”„ å†æ¥ä¸€æŠŠ</button>
    </div>

    <div id="stats">
        å·²é‡å¼€æ¬¡æ•°: <span id="restart-count">0</span> | æµªè´¹çš„äººç”Ÿ: <span id="time-wasted">0</span>ç§’
    </div>
</div>

<script>
    // === åŸºç¡€æ•°æ® ===
    const data = {
        civs: [
            "ç§¦å§‹çš‡ (ä¸­å›½)", "å½¼å¾—å¤§å¸ (ä¿„ç½—æ–¯)", "æ›¼æ²™Â·ç©†è¨ (é©¬é‡Œ)", 
            "çº¦ç¿°Â·æŸ¯å»· (æ¾³å¤§åˆ©äºš)", "å¸•æŸ¥åº“ç‰¹å…‹ (å°åŠ )", "ç»´å¤šåˆ©äºš (è‹±å›½)", 
            "è’™ç‰¹ç¥–ç› (é˜¿å…¹ç‰¹å…‹)", "åº“ä½© (æ¯›åˆ©)", "æ‰˜ç±³ä¸½å¸ (æ–¯åŸºæ³°)", 
            "æ±‰è°Ÿæ‹‰æ¯” (å·´æ¯”ä¼¦)", "è‹¥æ˜‚ä¸‰ä¸– (è‘¡è„ç‰™)", "æˆå‰æ€æ±— (è’™å¤)"
        ],
        terrains: [
            { text: "å¹³å¦çš„é›ªåŸ (æ— æ·¡æ°´)", score: -10, type: "snow" },
            { text: "å¹¿é˜”çš„å¹³æ²™ (æ²™æ¼ ä¸˜é™µ)", score: -5, type: "desert" },
            { text: "è‰åŸä¸˜é™µ (æ²¿æ²³)", score: 8, type: "grass" }, // å·´æ¯”ä¼¦éœ€è¦è¿™ä¸ª
            { text: "è¢«ç¾¤å±±åŒ…å›´ (æ­»èƒ¡åŒ)", score: -2, type: "mountain" },
            { text: "å†»åœŸä¸˜é™µ (æœ‰æ ‘)", score: 2, type: "tundra" },
            { text: "æµ·å²› (æ·±æµ·)", score: 0, type: "ocean" },
            { text: "å¹³åŸé›¨æ— (é«˜äº§å‡º)", score: 5, type: "plains" }
        ],
        resources: [
            { text: "å•¥ä¹Ÿæ²¡æœ‰", score: -5 },
            { text: "åªæœ‰ä¸€åªç¾Š", score: 0 },
            { text: "å¤§ç±³ + çŸ³å¤´", score: 3 },
            { text: "é¦™æ–™ (å¥¢ä¾ˆ)", score: 8 },
            { text: "å¸•ä¾ææ (è‡ªç„¶å¥‡è§‚)", score: 999 },
            { text: "å¤šä½›ç™½å´– (è‡ªç„¶å¥‡è§‚)", score: 1 },
            { text: "ç…¤ (å·¥ä¸šæ—¶ä»£çš„é»‘é‡‘)", score: 4 } 
        ]
    };

    // === å‰§æƒ…å‰§æœ¬ç³»ç»Ÿ ===
    let activeScenario = null; 

    const scenarios = [
        {
            // å·´æ¯”ä¼¦ + æ²¿æ²³ (é²å°”å±±è°·æµ)
            // é²å°”å±±è°·å¿…é¡»æ²¿æ²³ï¼Œä¸”éœ€è¦å·¥ä¸šåŒºã€‚
            check: (c, t, r) => c.includes("å·´æ¯”ä¼¦") && t.text.includes("æ²¿æ²³"),
            forceParams: { civKeyword: "å·´æ¯”ä¼¦", terrainType: "grass" },
            name: "æ—¶ç©ºç‰¹å¼‚ç‚¹",
            comment: "æ±‰è°Ÿæ‹‰æ¯” + æ²¿æ²³ä¸˜é™µï¼é²å°”å±±è°·å›¾çº¸å·²å°±ç»ªï¼Œå‡†å¤‡åœ¨å¤å…¸æ—¶ä»£èµ·é£ï¼",
            outcomes: [
                { type: "win", text: "ã€é™ç»´æ‰“å‡»ã€‘ä½ åˆ©ç”¨é«˜äº§èƒ½é€Ÿå‡ºäº†â€œé²å°”å±±è°·â€ï¼Œè§¦å‘ã€é£è¡Œã€‘å°¤é‡Œå¡ã€‚å½“é‚»å±…è¿˜åœ¨ç ”ç©¶å¦‚ä½•ä½¿ç”¨æŠ•çŸ³è½¦æ—¶ï¼Œä½ çš„åŒç¿¼æœºå·²ç»å¼€å§‹åœ¨ä»–ä»¬å¤´ä¸Šæ‹‰å±äº†ã€‚" },
                { type: "lose", text: "ã€ç¼ºæ²¹çš„æ‚²å‰§ã€‘ä½ æˆåŠŸåœ¨å…¬å…ƒå‰è§£é”äº†åŒç¿¼æœºï¼Œä½†ä½ å‘ç°åœ°å›¾ä¸Šæ²¡æœ‰çŸ³æ²¹ã€‚ä½ çš„ç©ºå†›åªèƒ½åœåœ¨æœºåœºå½“æ¨¡å‹ï¼Œæœ€åè¢«è›®æ—å‹‡å£«ç”¨æœ¨æ£’æ•²çƒ‚äº†ã€‚" },
                { type: "lose", text: "ã€ä¸¥é‡çš„åç§‘ç”Ÿã€‘ä½ åªé¡¾ç€å†²å·¥ä¸šå¥‡è§‚ï¼Œå®¶é‡Œæ²¡æœ‰å…µã€‚åœ¨é²å°”å±±è°·å»ºæˆçš„å‰ä¸€å›åˆï¼Œé‚»å±…æ–¯åŸºæ³°çš„éª‘æ‰‹å¤§å†›å†²è¿›äº†ä½ çš„é¦–éƒ½ã€‚å¥‡è§‚è¯¯å›½å•Šï¼" }
            ]
        },
        {
            // ç§¦å§‹çš‡ + æ²™æ¼ 
            check: (c, t, r) => c.includes("ç§¦å§‹çš‡") && t.type === "desert",
            forceParams: { civKeyword: "ç§¦å§‹çš‡", terrainType: "desert" },
            name: "å¤§å»ºå¥‡è§‚",
            comment: "ç§¦å§‹çš‡ + æ²™æ¼ ï¼è¿™æŠŠå¦‚æœä¸é€ å¤§é‡‘å­—å¡”ï¼Œå’Œå’¸é±¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ",
            outcomes: [
                { type: "win", text: "ã€å¥‡è§‚èƒœåˆ©ã€‘ä½ æ‰‹æ“äº†é‡‘å­—å¡”ã€ä½©ç‰¹æ‹‰ã€ç¥è°•ã€‚æ²™æ¼ å˜æˆäº†é»„é‡‘åŸï¼Œæ¸¸å®¢æŒ¤çˆ†äº†ä½ çš„è¾¹å¢ƒã€‚ä½ ä¸éœ€è¦é€ å…µï¼Œå¥‡è§‚å°±æ˜¯ä½ çš„é•¿åŸï¼" },
                { type: "lose", text: "ã€å¥‡è§‚è¯¯å›½ã€‘ä½ åœ¨æ‰‹æ“å¤§é‡‘å­—å¡”çš„æœ€å1å›åˆï¼Œè¢«éš”å£çš„åŸƒåŠæŠ¢å…ˆäº†ã€‚ä½ å¿ƒæ€å´©äº†ï¼ŒæŠŠé¼ æ ‡æ‘”äº†ã€‚æ¸¸æˆç»“æŸã€‚" },
                { type: "lose", text: "ã€è´ªå©ªçš„ä»£ä»·ã€‘ä½ é€ å¥½äº†å¤§é‡‘å­—å¡”ï¼Œä½†æ˜¯å®¶é‡Œæ²¡æœ‰ä¸€ä¸ªå…µã€‚ç¬¬30å›åˆï¼Œè›®æ—éª‘å…µå¤§é˜Ÿå…‰ä¸´ï¼Œä½ çš„å¥‡è§‚ç°åœ¨å½’è›®æ—äº†ã€‚" }
            ]
        },
        {
            // é©¬é‡Œ + æ²™æ¼ 
            check: (c, t, r) => c.includes("é©¬é‡Œ") && t.type === "desert",
            forceParams: { civKeyword: "é©¬é‡Œ", terrainType: "desert" },
            name: "é»„é‡‘å›½åº¦",
            comment: "æ›¼æ²™Â·ç©†è¨ + æ²™æ¼ ï¼é’±ä¸å†æ˜¯é—®é¢˜ï¼Œé—®é¢˜æ˜¯æ€ä¹ˆèŠ±å®Œå®ƒã€‚",
            outcomes: [
                { type: "win", text: "ã€é‡‘å¸èƒœåˆ©ã€‘ä½ çš„é’±å¤ªå¤šäº†ï¼Œä½ ç›´æ¥ä¹°ä¸‹äº†æ‰€æœ‰çš„åŸé‚¦ï¼Œé¡ºä¾¿æŠŠé‚»å±…çš„å†›é˜Ÿä¹Ÿä¹°è¿‡æ¥äº†ã€‚è¿™å«â€œæ¶æ„æ”¶è´­â€èƒœåˆ©ã€‚" },
                { type: "lose", text: "ã€æœ‰é’±æ²¡å‘½èŠ±ã€‘è™½ç„¶ä½ æ¯å›åˆæ”¶å…¥500é‡‘å¸ï¼Œä½†ä½ çš„ç”Ÿäº§åŠ›æ˜¯0ã€‚å½“è›®æ—æ‹¿ç€å¤§æ£’å†²è¿›æ¥æ—¶ï¼Œä½ è¿˜åœ¨ç”¨é‡‘å­ç Œå¢™ï¼Œå¯æƒœæ¥ä¸åŠäº†ã€‚" }
            ]
        },
        {
            // ä¿„ç½—æ–¯ + å†»åœŸ
            check: (c, t, r) => c.includes("ä¿„ç½—æ–¯") && (t.type === "tundra" || t.type === "snow"),
            forceParams: { civKeyword: "ä¿„ç½—æ–¯", terrainType: "tundra" },
            name: "æ ¸åŠ¨åŠ›åœ£åœ°",
            comment: "å½¼å¾— + å†»åœŸï¼æå…‰ä¹‹èˆ + èŒä¸šé“å¾·å·²ç»å°±ç»ªï¼Œå‡†å¤‡èµ·é£ï¼",
            outcomes: [
                { type: "win", text: "ã€ç”Ÿäº§åŠ›éœ¸æƒã€‘ä½ çš„ä¿®é“é™¢æä¾›äº†+20ç”Ÿäº§åŠ›ã€‚ä½ çš„åŸå¸‚åƒå·¥ä¸šæ€ªå…½ä¸€æ ·ç–¯ç‹‚äº§å‡ºï¼Œä½ åœ¨ä¸­ä¸–çºªå°±æ¨å¹³äº†å…¨ä¸–ç•Œã€‚" },
                { type: "lose", text: "ã€ä¿¡ä»°å´©å¡Œã€‘ä½ è™½ç„¶æœ‰æ ¸åŠ¨åŠ›åœ£åœ°ï¼Œä½†è¿˜æ²¡æ¥å¾—åŠå‘æ•™ï¼Œå°±è¢«é‚»å±…æ‹œå åº­ä¼ æ•™å£«éª‘è„¸æ´—æˆäº†å¼‚æ•™å¾’ã€‚èŒä¸šé“å¾·å¤±æ•ˆäº†ï¼Œä½ é€€å‡ºäº†æ¸¸æˆã€‚" }
            ]
        },
        {
            // æˆ˜ç‹‚
            check: (c, t, r) => c.includes("æ–¯åŸºæ³°") || c.includes("é˜¿å…¹ç‰¹å…‹"),
            forceParams: { civKeyword: "æ–¯åŸºæ³°", terrainType: "plains" }, 
            name: "æˆ˜äº‰æœºå™¨",
            comment: "æ—¢ç„¶é€‰äº†æˆ˜ç‹‚ï¼Œç§ç”°æ˜¯ä¸å¯èƒ½ç§ç”°çš„ï¼Œè¿™è¾ˆå­éƒ½ä¸å¯èƒ½ç§ç”°ã€‚",
            outcomes: [
                { type: "win", text: "ã€å¾æœèƒœåˆ©ã€‘ç¬¬80å›åˆï¼Œä½ çš„è½»éª‘å…µæ´ªæµå·²ç»è¸å¹³äº†è¿™ç‰‡å¤§é™†ã€‚æ²¡äººè®°å¾—ä½ æœ‰æ²¡æœ‰æ–‡åŒ–ï¼Œå› ä¸ºä»–ä»¬éƒ½æ­»å…‰äº†ã€‚" },
                { type: "lose", text: "ã€ç©·å…µé»©æ­¦ã€‘ä½ é€ äº†å¤ªå¤šå…µï¼Œå¯¼è‡´è´¢æ”¿èµ¤å­—ï¼Œå…µå˜äº†ã€‚ä½ çš„ç²¾é”éª‘æ‰‹è§£æ•£å›å®¶ç§åœ°å»äº†ã€‚" }
            ]
        }
    ];

    // æ™®é€šç»“å±€åº“
    const genericEndings = {
        win: [
            "ã€ç§‘æŠ€èƒœåˆ©ã€‘è™½ç„¶è¿‡ç¨‹åå·ï¼Œä½†ä½ æœ€åè¿˜æ˜¯è®©ç«ç®­å‡ç©ºäº†ã€‚",
            "ã€å¤–äº¤èƒœåˆ©ã€‘ä½ ç»™å…¨åœ°çƒäººæ¯äººå‘äº†ä¸€åŒé‹ï¼Œå…¨ç¥¨å½“é€‰åœ°çƒçƒé•¿ã€‚",
            "ã€åˆ†æ•°èƒœåˆ©ã€‘ç†¬åˆ°äº†500å›åˆï¼Œç†¬æ­»äº†æ‰€æœ‰å¯¹æ‰‹ï¼ˆç‰©ç†æ„ä¹‰ä¸Šï¼‰ã€‚"
        ],
        lose_barbarian_tech: [
            "ã€é™ç»´æ‰“å‡»ã€‘ä½ å‘ç°è¿™å±€æ¸¸æˆæœ‰å·´æ¯”ä¼¦ã€‚ç°åœ¨æ˜¯è¿œå¤æ—¶ä»£ï¼Œä½†è›®æ—è¥åœ°é‡Œèµ°å‡ºäº†æ‹¿ç€ç°ä»£æ­¥æªçš„æ¸¸éª‘å…µã€‚ä½ çš„æ£’å­å…µç”šè‡³æ¥ä¸åŠæ±‚é¥¶ã€‚",
            "ã€ç§‘æŠ€ä»£å·®ã€‘å› ä¸ºå·´æ¯”ä¼¦çš„å­˜åœ¨ï¼Œè›®æ—çš„ç§‘æŠ€æ°´å¹³æ¯”ä½ é«˜ä¸¤ä¸ªæ—¶ä»£ã€‚ä½ çš„æ¡¨å¸†èˆ¹åœ¨æµ·ä¸Šé‡åˆ°äº†è›®æ—é©±é€èˆ°ã€‚"
        ],
        lose_standard: [
            "ã€ç°å®Gankã€‘å¤©äº®äº†ï¼Œä½ è¦å»ä¸Šç­/ä¸Šå­¦äº†ã€‚å«æ³ªå­˜æ¡£é€€å‡ºã€‚",
            "ã€ç”˜åœ°æ ¸å¹³ã€‘ç”˜åœ°è§‰å¾—ä½ çš„å’Œå¹³æŒ‡æ•°ä¸å¤Ÿï¼Œå†³å®šç”¨æ ¸å¼¹æ•™ä½ å’Œå¹³ã€‚",
            "ã€å¿ è¯šåº¦é›ªå´©ã€‘ä½ æ‹åŸæ‹åˆ°äº†è‰¾è‰è¯ºè„¸ä¹¦ä¸Šï¼Œ5å›åˆåï¼Œé‚£æ˜¯å¥¹çš„åŸäº†ã€‚",
            "ã€è‡ªç„¶ç¾å®³ã€‘è¿™å±€å› ä¸ºæ’ç¢³å¤ªå¤šï¼Œæµ·å¹³é¢ä¸Šå‡ï¼Œä½ çš„æ²¿æµ·é¦–éƒ½å˜æˆäº†äºšç‰¹å…°è’‚æ–¯ã€‚"
        ]
    };

    const quotes = [
        "ä»æ°´ä¸‹çš„ç¬¬ä¸€ä¸ªç”Ÿå‘½èŒèŠ½å¼€å§‹...",
        "åˆ°çŸ³å™¨æ—¶ä»£çš„å·¨å‹é‡å…½...",
        "å†åˆ°äººç±»ç¬¬ä¸€æ¬¡ç›´ç«‹è¡Œèµ°...",
        "ä½ å†ç»åŠ«éš¾...",
        "ç»ˆäºæ¥åˆ°äº†æ–‡æ˜çš„æ‘‡ç¯®ã€‚"
    ];

    let restartCount = 0;
    let currentScore = 0;
    let isGodMode = false;

    // === é€»è¾‘å‡½æ•° ===

    function triggerGodMode() {
        if (!isGodMode) {
            isGodMode = true;
            alert("ğŸ› ï¸ ç§‘æŠ€æ ‘ä¿®æ”¹å™¨å·²å¯åŠ¨ï¼\nä¸‹ä¸€æŠŠå¿…å®šè§¦å‘ã€ç‰¹æ®Šå‰§æœ¬ã€‘ï¼");
            startDive(); 
        }
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(el => el.style.display = 'none');
        document.getElementById(id).style.display = (id === 'loading-screen') ? 'flex' : 'block';
    }

    function startDive() {
        showScreen('loading-screen');
        if (restartCount > 0) {} 
        restartCount++;
        document.getElementById('restart-count').innerText = restartCount - 1; 
        updateTime();

        // åŠ¨ç”»
        let quoteDiv = document.getElementById('quote-text');
        let progressDiv = document.getElementById('loader-progress');
        quoteDiv.style.opacity = 0;
        progressDiv.style.width = "0%";
        let loadInterval = setInterval(() => {
            let w = parseFloat(progressDiv.style.width) || 0;
            if (w >= 100) clearInterval(loadInterval);
            progressDiv.style.width = (w + 2.5) + "%";
        }, 30);
        
        quoteDiv.innerText = quotes[0];
        quoteDiv.style.opacity = 1;
        setTimeout(() => { quoteDiv.innerText = quotes[1]; }, 700);
        setTimeout(() => { quoteDiv.innerText = quotes[2]; }, 1400);
        setTimeout(() => { quoteDiv.innerText = "ç”Ÿæˆåœ°å›¾ç§å­ #"+Math.floor(Math.random()*999999); }, 2100);

        setTimeout(() => {
            generateResult();
        }, 2500);
    }

    function generateResult() {
        showScreen('result-screen');
        activeScenario = null; // é‡ç½®å‰§æœ¬

        let civ, terrain, resource;

        if (isGodMode) {
            // === ä½œå¼Šæ¨¡å¼ï¼šéšæœºæŠ½å–ä¸€ä¸ªå‰§æœ¬ ===
            const randomScenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            
            // æ ¹æ®å‰§æœ¬çš„ forceParams å¼ºåˆ¶è®¾ç½®å˜é‡
            civ = data.civs.find(c => c.includes(randomScenario.forceParams.civKeyword)) || "å·´æ¯”ä¼¦";
            terrain = data.terrains.find(t => t.type === randomScenario.forceParams.terrainType) || data.terrains[0];
            
            // èµ„æºç»™å¥½ä¸€ç‚¹
            resource = data.resources[3]; // é¦™æ–™
            if(Math.random() > 0.7) resource = data.resources[4]; 
            
            isGodMode = false; 
        } else {
            // === æ­£å¸¸éšæœº ===
            civ = data.civs[Math.floor(Math.random() * data.civs.length)];
            terrain = data.terrains[Math.floor(Math.random() * data.terrains.length)];
            resource = data.resources[Math.floor(Math.random() * data.resources.length)];
        }

        document.getElementById('civ-name').innerText = civ;
        document.getElementById('terrain-info').innerText = terrain.text;
        document.getElementById('resource-info').innerText = resource.text;

        let score = terrain.score + resource.score;
        let commentBox = document.getElementById('system-comment');
        let comment = "";
        let color = "#e74c3c";

        // === 1. æ£€æµ‹æ˜¯å¦è§¦å‘å‰§æœ¬ ===
        for (let s of scenarios) {
            if (s.check(civ, terrain, resource)) {
                activeScenario = s;
                comment = "âš¡ è§¦å‘å‰§æƒ…ï¼š" + s.comment;
                color = "var(--special-purple)"; 
                score += 20; 
                break;
            }
        }

        // === 2. æ²¡å‰§æœ¬åˆ™èµ°å¸¸è§„ ===
        if (!activeScenario) {
            if (resource.text.includes("å¸•ä¾ææ")) {
                comment = "å¸•ä¾ææéª‘è„¸ï¼(Sçº§)";
                color = "#f1c40f";
            } else if (score < -5) {
                comment = "è¿™å›¾ç‹—çœ‹äº†éƒ½æ‘‡å¤´ã€‚(Fçº§)";
            } else if (score < 5) {
                comment = "å¹³å¹³æ— å¥‡ã€‚(Cçº§)";
                color = "#f39c12";
            } else {
                comment = "å“å“Ÿï¼Œè¿™å›¾ä¸é”™å“¦ï¼(Açº§)";
                color = "#2ecc71";
            }
        }

        currentScore = score;
        commentBox.innerText = comment;
        commentBox.style.color = color;
    }

    function playGame() {
        showScreen('outcome-screen');
        let titleDiv = document.getElementById('outcome-title');
        let descDiv = document.getElementById('outcome-desc');
        
        let winChance = 0.4 + (currentScore * 0.05);
        if (winChance > 0.9) winChance = 0.9;
        if (winChance < 0.1) winChance = 0.1;
        let roll = Math.random();

        // 1. å‰§æœ¬ç»“å±€
        if (activeScenario) {
            let outcome = activeScenario.outcomes[Math.floor(Math.random() * activeScenario.outcomes.length)];
            if (outcome.type === 'win') {
                titleDiv.innerText = "VICTORY / å²è¯—èƒœåˆ©";
                titleDiv.style.color = "var(--win-green)";
            } else {
                titleDiv.innerText = "DEFEAT / å²è¯—å¤±è´¥";
                titleDiv.style.color = "var(--lose-red)";
            }
            descDiv.innerText = outcome.text;
            return;
        }

        // 2. å¸¸è§„ç»“å±€ (å·´æ¯”ä¼¦å½©è›‹)
        if (Math.random() < 0.1) {
            titleDiv.innerText = "DEFEAT / æƒ¨é­å± æ€";
            titleDiv.style.color = "var(--lose-red)";
            descDiv.innerText = genericEndings.lose_barbarian_tech[Math.floor(Math.random() * genericEndings.lose_barbarian_tech.length)];
            return;
        }

        if (roll < winChance) {
            titleDiv.innerText = "VICTORY / èƒœåˆ©";
            titleDiv.style.color = "var(--win-green)";
            descDiv.innerText = genericEndings.win[Math.floor(Math.random() * genericEndings.win.length)];
        } else {
            titleDiv.innerText = "DEFEAT / å¤±è´¥";
            titleDiv.style.color = "var(--lose-red)";
            descDiv.innerText = genericEndings.lose_standard[Math.floor(Math.random() * genericEndings.lose_standard.length)];
        }
    }

    function updateTime() {
        let seconds = (restartCount - 1) * 30;
        if(seconds < 0) seconds = 0;
        document.getElementById('time-wasted').innerText = seconds;
    }

    startDive();
</script>

</body>
</html>
